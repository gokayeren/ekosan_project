{% extends "base.html" %}

{% block title %}Ekosan - Profesyonel Çözümler{% endblock %}

{% block content %}

{% set hero_slider_key = home_config.hero_slider.group_key if home_config.hero_slider else None %}
{% set hero_items = get_slider(hero_slider_key) if hero_slider_key else [] %}

{# --- HERO SECTION --- #}
<div class="relative w-full h-[500px] lg:h-[700px] bg-neutral-900 overflow-hidden font-sans group">
    
    {# Mobilde performans için fade efekti yerine slide veya basit geçiş düşünülebilir, ancak fade CSS ile optimize edildi #}
    <div class="swiper myHeroSwiper h-full w-full pointer-events-none"> 
        <div class="swiper-wrapper">
            
            {% if hero_items %}
                {% for item in hero_items %}
                <div class="swiper-slide relative w-full h-full">
                    
                    <div class="absolute inset-0 z-0">
                        {% if item.image_path %}
                            {# Performans: İlk slayt öncelikli yüklenir, diğerleri lazy load #}
                            <img src="{{ url_for('static', filename='uploads/' + item.image_path) }}" 
                                 class="w-full h-full object-cover transform scale-105" 
                                 alt="{{ item.title }}"
                                 {% if loop.first %}fetchpriority="high" loading="eager"{% else %}loading="lazy"{% endif %} />
                        {% else %}
                            <img src="https://images.unsplash.com/photo-1513694203232-719a280e022f?w=1920&q=80&fit=crop" 
                                 class="w-full h-full object-cover" 
                                 alt="Varsayılan Görsel" loading="lazy" />
                        {% endif %}
                    </div>

                    {# Gradient Katmanları: CSS ile birleştirildi #}
                    <div class="absolute inset-0 z-10 bg-gradient-to-r from-black/90 via-black/40 to-transparent"></div>
                    
                    {# İçerik #}
                    <div class="relative z-20 container mx-auto px-4 md:px-6 max-w-7xl h-full flex flex-col justify-center">
                        <div class="w-full max-w-3xl space-y-6 mt-8">
                            
                            <div class="text-left overflow-hidden">
                                {% if item.title %}
                                    <h1 class="hero-text text-3xl md:text-5xl lg:text-7xl font-black text-white leading-tight mb-4 drop-shadow-lg tracking-tight opacity-0 translate-y-8 transition-all duration-700 ease-out">
                                        {{ item.title }}
                                    </h1>
                                {% endif %}
                                
                                {% if item.subtitle %}
                                    <p class="hero-text text-gray-200 text-base md:text-xl font-light leading-relaxed drop-shadow-md max-w-xl opacity-0 translate-y-8 transition-all duration-700 ease-out delay-100">
                                        {{ item.subtitle }}
                                    </p>
                                {% endif %}
                            </div>

                            <div class="hero-btn opacity-0 translate-y-8 transition-all duration-700 ease-out delay-200 pointer-events-auto">
                                {% if item.btn_text %}
                                    <a href="{{ item.btn_link or '#' }}" 
                                       class="inline-flex items-center justify-center bg-orange-600 hover:bg-orange-500 text-white font-bold shadow-lg shadow-orange-900/20 rounded px-8 py-3.5 transition-all active:scale-95 hover:shadow-orange-600/30">
                                       {{ item.btn_text }}
                                       <i class="fa fa-arrow-right ml-2 text-sm"></i>
                                    </a>
                                {% endif %}
                            </div>

                        </div>
                    </div>
                </div>
                {% endfor %}
            {% endif %}

        </div>
    </div>
</div>

{# --- VIDEO / PRESENTATION SECTION --- #}
<section class="flex justify-center py-16 border-b border-gray-100 relative overflow-hidden bg-white">
    
    {# Arka plan ikonu optimize edildi (sabit pozisyon, render maliyeti düşük) #}
    <div class="absolute -top-10 -right-10 opacity-[0.03] pointer-events-none select-none">
        <i class="fa fa-play-circle text-[15rem] text-gray-900"></i>
    </div>

    <div class="container px-4 relative z-10 fade-in-up">
        <div class="flex flex-col justify-center items-center gap-4 text-center">
            
            <div class="relative group cursor-pointer">
                <div class="absolute inset-0 bg-blue-600 rounded-full blur opacity-20 group-hover:opacity-40 transition-opacity duration-500 animate-pulse"></div>
                <a href="{{ home_config.presentation_action_url or '#' }}" 
                    class="relative flex items-center justify-center w-16 h-16 bg-blue-600 hover:bg-blue-500 text-white rounded-full shadow-xl shadow-blue-600/30 transition-transform duration-300 hover:scale-110 active:scale-95">
                    <i class="fa fa-play text-xl ml-1"></i>
                </a>
            </div>

            <div>
                <h2 class="text-xl md:text-2xl font-black text-gray-900 leading-tight tracking-tight mb-2">
                    {{ home_config.presentation_title }}
                </h2>
                <p class="text-sm md:text-base text-gray-500 font-light max-w-2xl mx-auto">
                    {{ home_config.presentation_subtitle }}
                </p>
                {% if home_config.presentation_action_text %}
                <div class="mt-3">
                    <span class="text-blue-600 font-bold tracking-widest text-xs uppercase border-b border-blue-100 pb-1">
                        {{ home_config.presentation_action_text }}
                    </span>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{# --- SERVICES SECTION (Modern Grid) --- #}
{# content-visibility: auto performans için eklenir (viewport dışındaysa render etmez) #}
<section class="py-16 bg-gray-50 relative overflow-hidden" style="content-visibility: auto;">
    
    {# SVG Pattern: Base64 yerine dosya yolu, lazy loading background için CSS class kullanılabilir #}
    <div class="absolute inset-0 z-0 opacity-[0.03] pointer-events-none"
         style="background-image: url('{{ url_for('static', filename='img/pattern.svg') }}');">
    </div>

    <div class="container mx-auto px-4 max-w-7xl relative z-10">

        <div class="flex flex-col md:flex-row justify-between items-end mb-10 gap-4 fade-in-up">
            <div>
                <span class="block text-orange-600 font-bold tracking-[0.2em] text-xs uppercase mb-2">
                    Hizmetlerimiz
                </span>
                <h3 class="text-2xl md:text-3xl font-black text-gray-900">
                    {{ home_config.features_title }}
                </h3>
            </div>
            <div class="hidden md:block w-24 h-1 bg-gray-200 rounded-full"></div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for service in services %}

            {# Kart Yapısı: Mobilde hover yok, bu yüzden içerik her zaman görünür olmalı #}
            {# Masaüstünde (lg) hover efektleri aktif #}
            <div class="group relative h-[300px] w-full rounded-2xl overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-500 hover:-translate-y-2 fade-in-up" 
                 style="animation-delay: {{ loop.index0 * 100 }}ms">
                
                <a href="#" class="block w-full h-full">
                    {# Görsel #}
                    <div class="absolute inset-0 bg-gray-800">
                        {% if service.image_path %}
                        <img src="{{ url_for('static', filename='uploads/' + service.image_path) }}" 
                             alt="{{ service.title }}"
                             loading="lazy"
                             class="w-full h-full object-cover opacity-80 group-hover:opacity-60 group-hover:scale-110 transition-transform duration-700 ease-in-out" />
                        {% else %}
                        <img src="https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=600&q=80" 
                             class="w-full h-full object-cover opacity-80 group-hover:scale-110 transition-transform duration-700" />
                        {% endif %}
                    </div>
                    
                    {# Gradient Overlay #}
                    <div class="absolute inset-0 bg-gradient-to-t from-black via-black/50 to-transparent opacity-90 transition-opacity duration-300"></div>

                    {# İçerik - Mobilde her zaman görünür (bottom-0), Masaüstünde hover ile yukarı kayar #}
                    <div class="absolute bottom-0 left-0 w-full p-6 translate-y-2 lg:translate-y-8 lg:group-hover:translate-y-0 transition-transform duration-500">
                        
                        <div class="flex items-center gap-2 mb-2">
                            <span class="w-8 h-1 bg-orange-500 rounded-full"></span>
                            <h4 class="text-white font-bold text-lg md:text-xl line-clamp-1">
                                {{ service.title }}
                            </h4>
                        </div>

                        {# Açıklama: Masaüstünde varsayılan olarak gizli (opacity-0), hoverda görünür. Mobilde hep görünür. #}
                        <p class="text-gray-300 text-sm leading-relaxed line-clamp-2 mb-4 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-500 delay-75">
                            {{ service.description|striptags }}
                        </p>
                        
                        <div class="flex items-center text-white text-xs font-bold uppercase tracking-wider gap-2 opacity-100 lg:opacity-0 lg:group-hover:opacity-100 transition-opacity duration-500 delay-100">
                            Detayları İncele <i class="fa fa-arrow-right text-orange-500"></i>
                        </div>
                    </div>
                </a>
            </div>

            {% else %}
            <div class="col-span-full py-12 text-center text-gray-500 bg-white rounded-lg border border-dashed">
                Hizmet bulunamadı.
            </div>
            {% endfor %}
        </div>
    </div>
</section>

{# --- PARALLAX SECTION (JS Free / CSS Only Parallax for Performance) --- #}
<section class="relative w-full h-[350px] md:h-[450px] flex items-center overflow-hidden bg-gray-900 clip-path-parallax">
    
    {# CSS Parallax yerine modern fixed background. iOS'ta fixed sorunlu olduğu için absolute + js observer daha iyidir ama CSS en temizidir. #}
    {# Burada performansı korumak için basit bir resim bindirme kullanıyoruz. #}
    <div class="absolute inset-0 z-0">
        <img src="{{ url_for('static', filename='uploads/' + home_config.parallax_image) }}" 
             class="w-full h-full object-cover opacity-60"
             loading="lazy"
             alt="Parallax Background">
             
        <div class="absolute inset-0 bg-gradient-to-r from-black/80 to-transparent"></div>
    </div>

    <div class="container relative z-10 mx-auto px-4 max-w-6xl text-white fade-in-up">
        <div class="max-w-2xl">
            <span class="inline-block py-1 px-3 border border-white/20 rounded-full bg-white/10 backdrop-blur-md text-xs font-bold uppercase tracking-wider mb-6">
                {{ home_config.parallax_title }}
            </span>
            <h2 class="text-2xl md:text-4xl lg:text-5xl font-black leading-tight mb-6">
                {{ home_config.parallax_subtitle }}
            </h2>
            <a href="{{ url_for('contact.index') }}" class="btn btn-outline text-white border-white hover:bg-white hover:text-black transition-colors rounded-full px-8">
                İletişime Geç
            </a>
        </div>
    </div>
</section>

<style>
    /* İlk giriş animasyonları için CSS sınıfları */
    .fade-in-up {
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        will-change: opacity, transform;
    }
    .fade-in-up.is-visible {
        opacity: 1;
        transform: translateY(0);
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        
        // 1. INTERSECTION OBSERVER (Scroll Animasyonları için)
        // Scroll event listener yerine bunu kullanmak CPU kullanımını %90 azaltır.
        const observerOptions = {
            root: null,
            rootMargin: '0px',
            threshold: 0.1 // %10'u görünür olduğunda tetikle
        };

        const observer = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('is-visible');
                    observer.unobserve(entry.target); // Bir kere çalışsın ve dursun
                }
            });
        }, observerOptions);

        document.querySelectorAll('.fade-in-up').forEach((el) => {
            observer.observe(el);
        });

        // 2. HERO SWIPER (Optimize Edilmiş)
        // Mobilde gereksiz hesaplamaları kapatıyoruz.
        if (typeof Swiper !== 'undefined') {
            var heroSwiper = new Swiper(".myHeroSwiper", {
                spaceBetween: 0,
                effect: "fade",
                fadeEffect: { crossFade: true },
                speed: 1500, // Daha doğal geçiş hızı
                loop: true,
                allowTouchMove: false, // Arka plan olduğu için touch kapatıldı (Performans artışı)
                autoplay: {
                    delay: 6000,
                    disableOnInteraction: false,
                    pauseOnMouseEnter: false
                },
                on: {
                    init: function() {
                        animateHeroText(this.slides[this.activeIndex]);
                    },
                    slideChangeTransitionStart: function () {
                        // Slayt değişirken metinleri sıfırla
                        this.slides.forEach(slide => {
                            const texts = slide.querySelectorAll('.hero-text, .hero-btn');
                            texts.forEach(el => {
                                el.classList.remove('opacity-100', 'translate-y-0');
                                el.classList.add('opacity-0', 'translate-y-8');
                            });
                        });
                    },
                    slideChangeTransitionEnd: function () {
                        animateHeroText(this.slides[this.activeIndex]);
                    }
                }
            });
        }

        function animateHeroText(slide) {
            const elements = slide.querySelectorAll('.hero-text, .hero-btn');
            elements.forEach((el, index) => {
                // setTimeout ile stagger (sıralı) efekti veriyoruz
                setTimeout(() => {
                    el.classList.remove('opacity-0', 'translate-y-8');
                    el.classList.add('opacity-100', 'translate-y-0');
                }, index * 200); // Her eleman 200ms arayla gelsin
            });
        }
    });
</script>

{% endblock %}